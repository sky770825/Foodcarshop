# 🔄 場地工作表自動同步功能（基於 GID 精準定位）

## 📋 功能說明

當您在「場地清單」工作表（gid=915045185）中修改場地名稱（B 欄）時，系統會**自動更新**對應的庫存和訂單工作表名稱，**並同步更新超連結顯示文字**。

### ✨ 核心優勢

- **精準定位**：使用 GID 直接定位工作表，不會誤改其他工作表
- **即時同步**：修改 B 欄後立即生效（啟用自動同步時）
- **超連結更新**：同步更新 D 欄和 E 欄的超連結顯示文字
- **零配置**：GID 映射已內建在代碼中，無需初始化

---

## 🗺️ 場地代號與 GID 映射表

| 場地代號 | 庫存管理 GID | 訂單記錄 GID |
|---------|------------|------------|
| venue_a | 1310218309 | 839188314 |
| venue_b | 1817300773 | 770659658 |
| venue_c | 927975724  | 2090345169 |
| venue_d | 1587321409 | 176378257 |
| venue_e | 1533285254 | 1391460211 |

---

## 📊 場地清單工作表結構

**工作表名稱：** 場地清單  
**GID：** 915045185

| A 欄 | B 欄 | C 欄 | D 欄 | E 欄 |
|------|------|------|------|------|
| 場地代號 | 場地名稱 | 狀態 | 庫存管理超連結 | 訂單記錄超連結 |
| venue_a | 大中華場地 | 營業中 | =HYPERLINK("#gid=1310218309", "大中華場地_庫存管理") | =HYPERLINK("#gid=839188314", "大中華場地_訂單記錄") |
| venue_b | 信義場地 | 營業中 | =HYPERLINK("#gid=1817300773", "信義場地_庫存管理") | =HYPERLINK("#gid=770659658", "信義場地_訂單記錄") |

---

## 🎯 使用範例

### **情境：將「大中華場地」改名為「台北大中華店」**

#### **操作前：**

```
場地清單（B 欄）：大中華場地
工作表名稱：
  - 大中華場地_庫存管理 (GID: 1310218309)
  - 大中華場地_訂單記錄 (GID: 839188314)
超連結顯示：
  - D 欄：大中華場地_庫存管理
  - E 欄：大中華場地_訂單記錄
```

#### **操作：**

1. 在場地清單的 B 欄，將「大中華場地」改成「台北大中華店」
2. 點擊「🏪 場地管理」→「🔄 同步場地工作表名稱」（或啟用自動同步）

#### **操作後：**

```
場地清單（B 欄）：台北大中華店
工作表名稱：
  - 台北大中華店_庫存管理 (GID: 1310218309) ✅ 已更新
  - 台北大中華店_訂單記錄 (GID: 839188314) ✅ 已更新
超連結顯示：
  - D 欄：台北大中華店_庫存管理 ✅ 已更新
  - E 欄：台北大中華店_訂單記錄 ✅ 已更新
```

---

## 🚀 使用方式

### **方式一：手動同步** 👍 推薦

```
1. 修改場地清單的 B 欄（場地名稱）
   ↓
2. 點擊頂部菜單：🏪 場地管理 → 🔄 同步場地工作表名稱
   ↓
3. 系統自動更新工作表名稱和超連結
   ↓
4. 顯示同步結果
```

**優點：**
- 可控性高，自己決定何時同步
- 適合批量修改多個場地後一次同步
- 不會誤觸發

---

### **方式二：自動同步** ⚡ 進階

```
1. 點擊頂部菜單：🏪 場地管理 → ⚙️ 啟用自動同步
   ↓
2. 之後每次修改 B 欄（場地名稱）時自動同步
   ↓
3. 無需手動操作
```

**優點：**
- 即時同步，改完立即生效
- 適合頻繁修改場地名稱的情況

**注意事項：**
- 只有修改 B 欄時才會觸發
- 編輯後延遲 1 秒執行
- 如不需要，點擊「🔕 停用自動同步」

---

## 🔍 系統運作原理

### **1. GID 映射表（內建在代碼中）**

```javascript
const VENUE_GID_MAP = {
  'venue_a': { inventory: '1310218309', order: '839188314' },
  'venue_b': { inventory: '1817300773', order: '770659658' },
  'venue_c': { inventory: '927975724', order: '2090345169' },
  'venue_d': { inventory: '1587321409', order: '176378257' },
  'venue_e': { inventory: '1533285254', order: '1391460211' }
};
```

### **2. 同步流程**

```
1. 讀取場地清單 (gid=915045185)
   - A 欄：場地代號 (venue_a)
   - B 欄：場地名稱 (台北大中華店)
   ↓
2. 從映射表查詢對應的 GID
   - inventory: 1310218309
   - order: 839188314
   ↓
3. 用 GID 精準定位工作表
   - 透過 sheet.getSheetId() 匹配
   ↓
4. 重命名工作表
   - 台北大中華店_庫存管理
   - 台北大中華店_訂單記錄
   ↓
5. 更新超連結顯示文字
   - D 欄：=HYPERLINK("#gid=1310218309", "台北大中華店_庫存管理")
   - E 欄：=HYPERLINK("#gid=839188314", "台北大中華店_訂單記錄")
```

---

## ⚠️ 重要注意事項

### **✅ 可以修改的**

- ✅ **B 欄（場地名稱）** - 隨時可以修改，系統會自動同步
- ✅ **C 欄（狀態）** - 不影響同步功能

### **❌ 不可修改的**

- ❌ **A 欄（場地代號）** - 場地代號是系統唯一標識，不可修改
- ❌ **D 欄、E 欄（超連結）** - 系統會自動更新，手動修改會被覆蓋
- ❌ **工作表的 GID** - GID 是 Google Sheets 自動分配的，無法修改

---

## 💡 常見問題

### Q1：可以添加新場地嗎？

可以，但需要更新代碼中的 `VENUE_GID_MAP`：

1. 在場地清單新增一行（例如：venue_f）
2. 手動創建對應的庫存和訂單工作表
3. 查看工作表的 GID（網址中的 `gid=` 後面的數字）
4. 在代碼中添加映射：
   ```javascript
   'venue_f': { inventory: 'XXXXXXXX', order: 'YYYYYYYY' }
   ```
5. 重新部署 Apps Script

---

### Q2：如果同步失敗怎麼辦？

1. 檢查 A 欄的場地代號是否正確（venue_a, venue_b, venue_c, venue_d, venue_e）
2. 檢查對應的工作表是否存在
3. 查看 Apps Script 執行記錄（查看 → 執行記錄）
4. 如果仍失敗，聯繫技術支援

---

### Q3：可以批量修改多個場地嗎？

可以！先修改所有場地名稱，然後執行一次「同步場地工作表名稱」即可。

---

### Q4：超連結會自動更新嗎？

會！系統會同時更新：
1. 工作表名稱
2. D 欄和 E 欄的超連結顯示文字

GID 保持不變，所以連結仍然有效。

---

### Q5：自動同步會消耗配額嗎？

會，但消耗很少。Google Apps Script 每日配額：
- 觸發器執行次數：1000 次/天
- 正常使用不會超過

---

## 🛠️ 技術細節

### **GID 是什麼？**

GID（Sheet ID）是 Google Sheets 為每個工作表分配的唯一標識符，顯示在網址中：

```
https://docs.google.com/spreadsheets/d/SHEET_ID/edit#gid=1310218309
                                                         ↑
                                                    這就是 GID
```

### **為什麼使用 GID？**

1. **唯一性**：每個工作表的 GID 是唯一的，不會重複
2. **穩定性**：工作表改名後 GID 不變
3. **精準性**：不會誤改其他工作表
4. **快速性**：直接定位，不需要遍歷查找

---

## 📞 技術支援

如有問題，請聯繫：**快閃餐車小幫手**  
LINE: https://lin.ee/YyXagFg

---

## 🎉 更新記錄

**v2.0 (2025-10-19)**
- 改用 GID 精準定位，移除複雜的名稱匹配邏輯
- 新增超連結自動更新功能
- 移除初始化映射步驟（GID 映射內建在代碼中）
- 簡化使用流程

---

© 2025 快閃餐車小幫手 · 系統功能說明

