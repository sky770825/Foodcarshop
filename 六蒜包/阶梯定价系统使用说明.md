# 💰 阶梯定价系统完整使用说明

## 🎯 系统概述

支援复杂的阶梯定价规则，**数量越多越优惠**，系统自动计算最优价格。

---

## 📊 工作表栏位说明

### **H 栏 - 基础单价**（必填）
- 填入：单个商品的价格
- 例如：`90`（表示单价 $90）
- 用途：计算基准、单买时的价格

### **I 栏 - 阶梯价格规则**（选填）
- 填入：价格规则字符串
- 格式：支持多种格式（见下方）
- 用途：定义数量优惠规则

---

## 📝 I 栏支持的格式（都可以用）

### **格式 1：简洁格式（推荐）** ⭐
```
1:90,2:170,3:250
```
- 意思：1个$90、2个$170、3个$250

### **格式 2：中文格式**
```
1颗$90、2颗$170、3颗$250
```
- 系统会自动识别

### **格式 3：简化格式**
```
2条250
```
- 意思：2条$250（单买按单价）

### **格式 4：混合格式**
```
1个$90，2个$170，3个$250
```
- 支持中英文标点混用

---

## 🎯 你的商品填写方式

### **六蒜包**
```
H 栏 = 90
I 栏 = 1:90,2:170,3:250
```

### **丹麥手撕包**
```
H 栏 = 90
I 栏 = 1:90,2:170,3:250
```

### **千層生乳吐司**
```
H 栏 = 130
I 栏 = 2:250
```
或
```
H 栏 = 130
I 栏 = 2条250
```

### **金磚吐司**
```
H 栏 = 45
I 栏 = 3:110
```

### **千層蛋塔**
```
H 栏 = 75
I 栏 = 3:200
```
注：买9送1的功能需要额外处理，可以先用 `3:200` 显示基础优惠

### **脆皮奶油烤年糕**
```
H 栏 = 25
I 栏 = 1:25,5:100,8:150
```

### **香蒜乳酪銀絲卷**
```
H 栏 = 60
I 栏 = 3:150
```

### **固定价格商品（香濃乳酪酥、手工丹麥蝴蝶酥）**
```
H 栏 = 100
I 栏 = （留空）
```

---

## 📋 快速复制数据（直接粘贴到工作表）

### **商品数据（A-N 栏完整版）：**

```
六蒜包	main	15	30	正常	主食	https://i.postimg.cc/FKLFbHb9/image.jpg	90	1:90,2:170,3:250		1	熱銷	酥脆外皮，濃郁蒜香	30
丹麥手撕包	main	10	20	正常	主食	https://i.postimg.cc/TwvdtvQ1/image.jpg	90	1:90,2:170,3:250		2	招牌	丹麥風味，手工撕開	
千層生乳吐司	main	8	15	正常	主食	https://i.postimg.cc/xxx.jpg	130	2:250		3		手工千層，奶香四溢	
巧克力千層吐司	main	5	10	正常	主食	https://i.postimg.cc/yyy.jpg	130	2:250		4		巧克力風味，香濃甜蜜	
金磚吐司	main	12	20	正常	主食	https://i.postimg.cc/zzz.jpg	45	3:110		5		金黃酥脆，口感綿密	
千層蛋塔	main	10	20	正常	甜點	https://i.postimg.cc/aaa.jpg	75	3:200		6	限量	葡式蛋塔，外酥內嫩	20
香濃乳酪酥6入/袋	main	15	30	正常	甜點	https://i.postimg.cc/bbb.jpg	100			7		濃郁乳酪，6入袋裝	
手工丹麥蝴蝶酥12入/袋	main	10	20	正常	甜點	https://i.postimg.cc/ccc.jpg	100			8		手工製作，12入袋裝	
脆皮奶油烤年糕	main	20	40	正常	甜點	https://i.postimg.cc/ddd.jpg	25	1:25,5:100,8:150		9	推薦	脆皮外層，奶油內餡	
香蒜乳酪銀絲卷	main	8	15	正常	主食	https://i.postimg.cc/eee.jpg	60	3:150		10		香蒜乳酪，銀絲Q彈	
```

**说明：**
- 每个商品占一行
- 用 Tab 键分隔各栏
- 图片网址需要你自己替换成真实的

---

## 🧮 价格计算示例

### **六蒜包（1:90,2:170,3:250）**

| 购买数量 | 计算方式 | 总价 | 平均单价 |
|---------|---------|------|---------|
| 1 个 | 1 × $90 | **$90** | $90 |
| 2 个 | 2组优惠价 | **$170** | $85 ⬇️ |
| 3 个 | 3组优惠价 | **$250** | $83 ⬇️ |
| 4 个 | 3组($250) + 1个($90) | **$340** | $85 |
| 5 个 | 3组($250) + 2组($170) | **$420** | $84 |
| 6 个 | 3组×2 = $250×2 | **$500** | $83 |

**系统自动选择最优组合！**

---

### **脆皮奶油烤年糕（1:25,5:100,8:150）**

| 购买数量 | 计算方式 | 总价 | 平均单价 |
|---------|---------|------|---------|
| 1 个 | 1 × $25 | **$25** | $25 |
| 5 个 | 5组优惠价 | **$100** | $20 ⬇️ |
| 8 个 | 8组优惠价 | **$150** | $18.75 ⬇️ |
| 10 个 | 8组($150) + 2个($25×2) | **$200** | $20 |

---

## 🌟 前端显示效果

### **商品卡片显示：**

```
┌─────────────────────────┐
│ 🔥 熱銷                │
│  [六蒜包图片]           │
│                         │
│  六蒜包       $90起     │ ← 显示基础单价
│  庫存(15/30)  1:90,2... │ ← 显示价格规则（简略）
│                         │
│  [ - ]  [ 2 ]  [ + ]   │ ← 用户选择数量
│  💡 再買1個，平均只要$83 │ ← 智能提示（动态）
└─────────────────────────┘
```

### **选择数量时的智能提示：**

```
用户选 1 个：
  → 总价 $90
  → 提示：💡 再買1個，平均每個只要 $85

用户选 2 个：
  → 总价 $170（自动应用优惠）
  → 提示：💡 再買1個，平均每個只要 $83

用户选 3 个：
  → 总价 $250（最优惠）
  → 提示：（无，已是最优）
```

---

## 📦 订单预览显示

### **示例：**
```
订单预览
├─ 六蒜包 × 3 (平均@$83)          $250
├─ 千層蛋塔 × 5 (平均@$66)        $333
└─ 脆皮年糕 × 8 (平均@$18)        $150
─────────────────────────────────────
                        订单总额：$733
```

**说明：**
- 显示平均单价（自动计算）
- 总价已应用所有阶梯优惠

---

## ⚠️ 特殊情况处理

### **烏豆沙蛋黃酥（价格待定）**

如果价格还没确定：
```
H 栏 = 0
I 栏 = （留空）
```

前端会显示：「價格載入中」

---

### **买X送Y（例如：买9送1）**

目前方案：
```
H 栏 = 75
I 栏 = 3:200,9:600
```

**未来可以扩展：**
在 I 栏添加特殊标记：
```
3:200,9:送1
```

后端识别「送」字，前端显示赠品提示。

---

## 🚀 部署步骤

### **Step 1: 重新部署后端**
1. 复制更新后的 `Google_Apps_Script_後端_多場地版.js`
2. 粘贴到 Google Apps Script 编辑器
3. 部署新版本

### **Step 2: 在 Google Sheets 执行**
1. 刷新 Google Sheets（F5）
2. 点击 `📦 庫存管理` → `🆕 新增價格與優惠欄位`
3. 等待执行完成

### **Step 3: 填写价格数据**
1. 在 H 栏填入基础单价
2. 在 I 栏填入价格规则
3. 保存

### **Step 4: 测试前端**
1. 刷新 `index.html`
2. 选择场地
3. 测试不同数量的价格计算

---

## 🧪 测试案例

### **测试 1：单价商品**
```
商品：香濃乳酪酥
H 栏 = 100
I 栏 = （空白）

测试：
- 买 1 个 → $100
- 买 2 个 → $200
- 买 3 个 → $300
```

### **测试 2：简单阶梯**
```
商品：千層生乳吐司
H 栏 = 130
I 栏 = 2:250

测试：
- 买 1 条 → $130
- 买 2 条 → $250 ✅ 应用优惠
- 买 3 条 → $380（$250 + $130）
- 买 4 条 → $500（$250 × 2）
```

### **测试 3：复杂阶梯**
```
商品：六蒜包
H 栏 = 90
I 栏 = 1:90,2:170,3:250

测试：
- 买 1 个 → $90
- 买 2 个 → $170 ✅
- 买 3 个 → $250 ✅
- 买 4 个 → $340（$250 + $90）
- 买 5 个 → $420（$250 + $170）
- 买 6 个 → $500（$250 × 2）
```

---

## 💡 智能提示示例

### **提示规则：**
- 距离下一个优惠阶梯不远时显示提示
- 计算平均单价差异
- 鼓励用户多买

### **示例：**
```
当前：买 1 个六蒜包 = $90
提示：💡 再買1個，平均每個只要 $85

当前：买 2 个六蒜包 = $170
提示：💡 再買1個，平均每個只要 $83

当前：买 3 个六蒜包 = $250
提示：（无，已是最优）
```

---

## 🎨 前端显示效果

### **1. 商品卡片显示：**
```
六蒜包
$90起                  ← H 栏（基础单价）
1:90,2:170...          ← I 栏（价格规则，简略显示）
```

### **2. 选择数量后：**
```
六蒜包
$90起
1:90,2:170...

[ - ]  [ 2 ]  [ + ]    ← 用户选了 2 个
💡 再買1個，平均只要$83   ← 动态提示
```

### **3. 订单预览：**
```
六蒜包 × 2 (平均@$85)     $170
千層蛋塔 × 3 (平均@$66)    $200
────────────────────────────
                  订单总额：$370
```

---

## 📊 后端数据结构

### **API 返回：**
```json
{
  "products": [{
    "name": "六蒜包",
    "basePrice": 90,
    "priceRules": [
      {"qty": 1, "price": 90},
      {"qty": 2, "price": 170},
      {"qty": 3, "price": 250}
    ],
    "priceRuleText": "1:90,2:170,3:250",
    "hasDiscount": true
  }]
}
```

---

## 🧮 计算逻辑说明

### **算法：**
```javascript
function calculateTierPrice(quantity, basePrice, priceRules) {
  // 1. 尝试所有阶梯组合
  // 2. 计算每种组合的总价
  // 3. 返回最便宜的价格
}
```

### **范例计算：买 5 个六蒜包**

```
方案 1：5 × $90 = $450
方案 2：2组($170) + 1个($90) = $430
方案 3：3组($250) + 2个($180) = $430
方案 4：1组($90) + 2组($170) = $430

最优方案：$420（3组 + 2组）
```

系统自动选择最优！

---

## 🎯 优势

### **对商家：**
- ✅ 鼓励客户多买（提高客单价）
- ✅ 清理库存（设定大量优惠）
- ✅ 灵活定价策略
- ✅ 自动计算，不会出错

### **对客户：**
- ✅ 买越多越划算
- ✅ 清楚的优惠提示
- ✅ 自动应用最优价格
- ✅ 不需要手动计算

---

## 💡 营销建议

### **策略 1：鼓励多买**
```
基础价：$30
阶梯价：1:30,2:55,3:75

效果：买3个比买1个划算很多
```

### **策略 2：清库存**
```
基础价：$40
阶梯价：5:150,10:250

效果：鼓励大量购买
```

### **策略 3：组合销售**
```
商品A：2:200
商品B：2:200
提示：「买2份六蒜包 + 2份丹麦包 = $400」
```

---

## 📞 技术支援

如有问题，请联系：**快閃餐車小幫手**  
LINE: https://lin.ee/YyXagFg

---

## 🎉 总结

✅ 支持复杂阶梯定价  
✅ 自动计算最优价格  
✅ 智能优惠提示  
✅ 灵活易用  
✅ 适合各种营销策略  

---

© 2025 快閃餐車小幫手 · 阶梯定价系统 v1.0

