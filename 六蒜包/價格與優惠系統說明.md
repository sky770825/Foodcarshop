# 💰 價格與優惠系統完整說明

## 🎯 系統概述

支援商品顯示**原價**、**優惠價**和**優惠標籤**，讓您可以靈活設定促銷活動。

---

## 📊 Google Sheets 工作表結構

### **完整欄位結構**

| 欄位 | 說明 | 範例 | 必填 |
|------|------|------|------|
| **A** | 商品名稱 | 六蒜包 | ✅ 必填 |
| **B** | 類型 | main / side | ✅ 必填 |
| **C** | 當前庫存 | 10 | ✅ 必填 |
| **D** | 初始庫存 | 20 | ✅ 必填 |
| **E** | 狀態 | 正常 / 暫停 | ✅ 必填 |
| **F** | 分類 | 主食 / 配菜 | ✅ 必填 |
| **G** | 圖片網址 | https://... | ⚠️ 建議填寫 |
| **H** | **原價** | 30 | 🆕 ⚠️ 建議填寫 |
| **I** | **優惠價** | 25 | 🆕 ⭐ 選填（有優惠時填） |
| **J** | **優惠標籤** | 限時特價 | 🆕 ⭐ 選填（顯示促銷訊息） |

---

## 📝 實際範例

### **範例 1：有優惠的商品**

| A 欄 | B 欄 | C 欄 | D 欄 | E 欄 | F 欄 | G 欄 | **H 欄** | **I 欄** | **J 欄** |
|------|------|------|------|------|------|------|----------|----------|----------|
| 六蒜包 | main | 10 | 20 | 正常 | 主食 | https://... | **30** | **25** | 限時特價 |

**前端顯示效果：**
```
🏷️ 限時特價
-----------
[商品圖片]
-----------
六蒜包        ~~$30~~  ← 原價（灰色划線）
              $25     ← 優惠價（紅色粗體）
```

---

### **範例 2：無優惠的商品**

| A 欄 | B 欄 | C 欄 | D 欄 | E 欄 | F 欄 | G 欄 | **H 欄** | **I 欄** | **J 欄** |
|------|------|------|------|------|------|------|----------|----------|----------|
| 千層吐司 | main | 5 | 10 | 正常 | 主食 | https://... | **40** | (空白) | (空白) |

**前端顯示效果：**
```
[商品圖片]
-----------
千層吐司      $40     ← 只顯示原價（橙色）
```

---

### **範例 3：多種優惠類型**

| A 欄 | B 欄 | C 欄 | D 欄 | E 欄 | F 欄 | G 欄 | H 欄 | I 欄 | J 欄 |
|------|------|------|------|------|------|------|------|------|------|
| 六蒜包 | main | 10 | 20 | 正常 | 主食 | ... | 30 | 25 | 限時特價 |
| 丹麥手撕包 | main | 8 | 15 | 正常 | 主食 | ... | 35 | 30 | 週末優惠 |
| 千層蛋塔 | main | 12 | 20 | 正常 | 甜點 | ... | 25 | 20 | 買一送一 |
| 生乳吐司 | main | 5 | 10 | 正常 | 主食 | ... | 40 | | |

**前端顯示：**
- 六蒜包：🏷️ 限時特價 ~~$30~~ **$25**
- 丹麥手撕包：🏷️ 週末優惠 ~~$35~~ **$30**
- 千層蛋塔：🏷️ 買一送一 ~~$25~~ **$20**
- 生乳吐司：**$40** （無優惠）

---

## 💻 後端數據處理

### **代碼位置：** `Google_Apps_Script_後端_多場地版.js` 第 493-566 行

### **數據讀取：**
```javascript
// 從工作表讀取 10 個欄位
const [name, type, currentStock, initialStock, status, category, 
       imageUrl, originalPrice, salePrice, saleLabel] = data[i];

// 價格處理邏輯
const price = salePrice || originalPrice || 0;  // 優先使用優惠價
const hasDiscount = salePrice && originalPrice && salePrice < originalPrice;

// 儲存到 inventory 物件
inventory[name] = {
  originalPrice: originalPrice || 0,     // H 欄：原價
  salePrice: salePrice || 0,             // I 欄：優惠價
  price: price,                          // 實際價格（用於計算）
  saleLabel: saleLabel || '',            // J 欄：優惠標籤
  hasDiscount: hasDiscount               // 是否有優惠
};
```

### **返回給前端的數據：**
```json
{
  "ok": true,
  "products": [
    {
      "name": "六蒜包",
      "img": "https://...",
      "price": 25,              // 實際價格（優惠價）
      "originalPrice": 30,      // 原價
      "salePrice": 25,          // 優惠價
      "saleLabel": "限時特價",   // 優惠標籤
      "hasDiscount": true,      // 有優惠
      "stock": 10
    }
  ]
}
```

---

## 🎨 前端顯示邏輯

### **代碼位置：** `index.html` 第 1702-1735 行

### **顯示規則：**

#### **情況 1：有優惠（hasDiscount = true）**
```html
<!-- 優惠標籤（左上角） -->
<div>🏷️ 限時特價</div>

<!-- 價格顯示（右側） -->
<div>
  <div style="text-decoration:line-through; color:#999;">$30</div>  <!-- 原價划線 -->
  <div style="color:#dc2626; font-weight:800;">$25</div>           <!-- 優惠價紅色 -->
</div>
```

#### **情況 2：無優惠（hasDiscount = false）**
```html
<!-- 價格顯示（右側） -->
<div style="color:#d97706; font-weight:700;">$40</div>  <!-- 只顯示原價 -->
```

---

## 🎯 使用場景

### **場景 1：日常營業**
所有商品只填 **H 欄（原價）**，不填 I 欄和 J 欄。

| 商品 | H 欄（原價）| I 欄（優惠價）| J 欄（標籤）|
|------|------------|-------------|------------|
| 六蒜包 | 30 | | |
| 丹麥手撕包 | 35 | | |

**顯示：** 正常價格，無優惠提示。

---

### **場景 2：限時促銷**
特定商品填寫 **I 欄（優惠價）**和 **J 欄（標籤）**。

| 商品 | H 欄 | I 欄 | J 欄 |
|------|------|------|------|
| 六蒜包 | 30 | 25 | 限時特價 |
| 丹麥手撕包 | 35 | | |

**顯示：**
- 六蒜包：🏷️ 限時特價 ~~$30~~ **$25**
- 丹麥手撕包：$35

---

### **場景 3：週末優惠**
週末時批量修改 **I 欄**和 **J 欄**。

| 商品 | H 欄 | I 欄 | J 欄 |
|------|------|------|------|
| 六蒜包 | 30 | 25 | 週末優惠 |
| 丹麥手撕包 | 35 | 30 | 週末優惠 |
| 千層蛋塔 | 25 | 20 | 週末優惠 |

**顯示：** 全部商品顯示週末優惠。

---

### **場景 4：清庫存促銷**
針對庫存過多的商品設置特價。

| 商品 | C 欄（庫存）| H 欄 | I 欄 | J 欄 |
|------|-----------|------|------|------|
| 千層蛋塔 | **20** | 25 | 15 | 清倉大特價 |

**顯示：** 🏷️ 清倉大特價 ~~$25~~ **$15**

---

## 🔄 促銷活動管理流程

### **開始促銷：**
```
1. 打開 Google Sheets
   ↓
2. 找到要促銷的商品
   ↓
3. 填寫 I 欄（優惠價）
   ↓
4. 填寫 J 欄（優惠標籤）例如：限時特價
   ↓
5. 保存工作表
   ↓
6. 用戶刷新網頁或切換場地即可看到優惠
```

### **結束促銷：**
```
1. 打開 Google Sheets
   ↓
2. 將 I 欄（優惠價）清空
   ↓
3. 將 J 欄（優惠標籤）清空
   ↓
4. 保存工作表
   ↓
5. 優惠標籤和划線價格自動消失
```

---

## 💡 優惠標籤建議

### **常用標籤範例：**
- 🔥 `限時特價`
- 🎉 `週末優惠`
- 💯 `買一送一`
- 🎁 `第二件半價`
- 🌟 `新品優惠`
- ⚡ `閃購特價`
- 🎈 `清倉大特價`
- 🏷️ `會員專屬`
- 💝 `滿額贈品`
- 🔖 `組合優惠`

### **標籤設計原則：**
1. **簡短有力**：3-5 個字最佳
2. **清楚明確**：讓顧客一眼看懂優惠內容
3. **製造急迫感**：如「限時」、「閃購」
4. **突出價值**：如「買一送一」、「半價」

---

## 🎨 視覺效果

### **有優惠的商品卡片：**
```
┌─────────────────────────┐
│ 🏷️ 限時特價            │ ← 紅色標籤（左上角）
│  ┌─────────────────┐   │
│  │                 │   │
│  │   [商品圖片]     │   │
│  │                 │   │
│  └─────────────────┘   │
│                         │
│  六蒜包        ~~$30~~  │ ← 原價划線（灰色小字）
│  庫存(10/20)    $25    │ ← 優惠價（紅色粗體）
│                         │
│  [ - ]  [ 0 ]  [ + ]   │
└─────────────────────────┘
```

### **無優惠的商品卡片：**
```
┌─────────────────────────┐
│  ┌─────────────────┐   │
│  │                 │   │
│  │   [商品圖片]     │   │
│  │                 │   │
│  └─────────────────┘   │
│                         │
│  千層吐司       $40     │ ← 正常價格（橙色）
│  庫存(5/10)             │
│                         │
│  [ - ]  [ 0 ]  [ + ]   │
└─────────────────────────┘
```

---

## 🔍 故障排查

### **問題 1：優惠沒有顯示**

**可能原因：**
1. I 欄（優惠價）為空
2. I 欄的優惠價 ≥ H 欄的原價
3. H 欄（原價）為空

**解決方法：**
1. 確認 H 欄有填入原價
2. 確認 I 欄有填入優惠價
3. 確認優惠價 < 原價
4. 刷新網頁或切換場地重新載入

---

### **問題 2：優惠標籤沒有顯示**

**可能原因：**
1. J 欄（優惠標籤）為空
2. 沒有優惠（I 欄為空）

**解決方法：**
1. 確認 I 欄有填入優惠價
2. 在 J 欄填入優惠標籤文字

---

### **問題 3：價格顯示不正確**

**檢查方法：**
```javascript
// 在瀏覽器控制台執行
console.log(PRODUCTS);

// 檢查每個商品的價格資訊
PRODUCTS.forEach(item => {
  console.log(item.name, {
    原價: item.originalPrice,
    優惠價: item.salePrice,
    實際價格: item.price,
    有優惠: item.hasDiscount
  });
});
```

---

## 📊 數據流程圖

```
Google Sheets
  ↓
H 欄（原價）→ originalPrice: 30
I 欄（優惠價）→ salePrice: 25
J 欄（優惠標籤）→ saleLabel: "限時特價"
  ↓
後端處理
  ↓
price = salePrice || originalPrice  // 25
hasDiscount = (25 < 30) = true
  ↓
返回 JSON
  ↓
{
  "originalPrice": 30,
  "salePrice": 25,
  "price": 25,
  "saleLabel": "限時特價",
  "hasDiscount": true
}
  ↓
前端顯示
  ↓
🏷️ 限時特價
~~$30~~  ← 原價划線
$25     ← 優惠價紅色
```

---

## 🎯 最佳實踐

### **1. 定期更新優惠**
- 每週檢查並更新促銷商品
- 及時清空過期的優惠標籤

### **2. 價格策略**
- 優惠價設定在原價的 70-85% 較合理
- 避免優惠價過低影響利潤

### **3. 標籤使用**
- 統一標籤風格（例如：都用「限時特價」而非混用「特價」「促銷」）
- 不同活動使用不同標籤（週末、節日、清倉）

### **4. 測試流程**
1. 修改 Google Sheets
2. 刷新前端網頁
3. 檢查價格和標籤是否正確顯示
4. 測試下單功能是否使用正確價格

---

## 📞 技術支援

如有問題，請聯繫：**快閃餐車小幫手**  
LINE: https://lin.ee/YyXagFg

---

## 🎉 更新記錄

**v1.0 (2025-10-19)**
- 🆕 新增原價、優惠價、優惠標籤功能
- 🆕 支援 H、I、J 三個新欄位
- 🆕 自動判斷是否有優惠
- 🆕 優惠商品顯示划線原價和紅色優惠價
- 🆕 左上角顯示優惠標籤

---

© 2025 快閃餐車小幫手 · 價格與優惠系統說明

